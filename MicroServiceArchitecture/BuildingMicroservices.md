## BUILDING MICROSERVICES

---

## 마이크로서비스 아키텍처 구축 - OREILLY 책 정리

마이크로서비스의 정의

1. 비즈니스 도메인에 따라 모델링
2. 독립적으로 릴리스가능
3. 캡슐화된 기능
4. 네트워크를 통해 다른 마이크로서비스와 통신

마이크로서비스는 캡슐화(정보은닉) 및 독립적인 릴리스를 위해 서비스별 자체 DB를 사용
->다른 서비스들에 제공할 데이터와 내부적 사용하는 데이터를 분리해서 운영할 수 있게됨
-> 내부 데이터 수정시 아주 자유로워짐

서비스를 나누는 경계는 비즈니스 도메인!
도메인 주도 설계의 개념을 가져옴

3tier 아키텍처는 한 계층을 바꿀 때 다른 계층들도 바꿔야하는 일이 자주 일어남

서비스의 크기는 코드를 잘 관리할 수 있는 정도의 크기로

MSA의 핵심
1. 독립적 배포성
2. 비즈니스 도메인 중심의 모델링
3. 자기 상태 소유
4. 크기
5. 유연성
점진적인 마이크로서비스로의 전환, 꼭 스위치 켜듯 확 안바뀌고 다이얼 돌리듯 전환할 수 있음
6. 조직개편
계층별 조직에서 애자일한 서비스별 팀조직
핸드오프와 사일로가 줄어듦
핸드오프 : 작업이 타인에게 넘어갈 때 드는 시간이나 생길수 있는 문제/오류
사일로 : 해당 팀만 알고있는 작업에 대한 내용

모놀리스->MSA라면
모놀리스는 무엇인가
배포할 때 한 번에 배포해야하면 모놀리식 아키텍처이다
장점
1. 단순하고
2. 코드 재사용이 간편하고(하나에 다 들어있으니)
3. 테스팅이 쉽다

모놀리스는 레거시와 다르다!


마이크로서비스를 도입하면서 관리해야하는 프로세스가 많아지기 때문에 기술을 몇가지 도입하는 것이 좋다
너무 도입하면 오히려 혼란 가능성있음
1. 로그 집계 시스템
이건 꽤 중요함
모든 서비스에서 로그를 한 곳에 수집해서 분석할 수 있게 해줌
휴미오, 예거, 라이트스텝, 허니콤, 클라우드 로깅 서비스 등...

2. 컨테이너/쿠버네티스
3. 스트리밍
마이크로서비스끼리 데이터를 공유하는 방법
아파치 카프카(데이터 영구성, 압축, 대용량 메시지 처리 확장기능)
4. 공용클라우드 및 서버리스
클라우드 플랫폼에서 여러 관리형 서비스들을 제공하고있음
서버리스를 통해 더 하이레벨의 추상화수준에서 작업이 가능해짐 (데이터베이스나 메시지브로커 등)

마이크로서비스의 장점

1. 서비스별로 특화된 언어와 데이터베이스를 적용가능
2. 한 서비스가 무너져도 다른 서비스에 영향이 안감
3. 서비스별로 확장이 가능해짐(수평적 확장)
4. 서비스별 배포에서 오는 속도와 빠른 롤백
5. 작은 코드베이스
한 코드베이스에서 작업하는 인원이 줄고, 오류발생 확률도 적어짐
6. 재사용성
서비스별로 모바일,웹 등 여러 엔드포인트에서 접근해서 해당 기능을 사용할 수 있게됨

단점

1. 기술 과다
마이크로서비스 도입을 위해 여러 기술들(언어, 런타임, 데이터베이스)을 도입하는 것과
데이터 일관성, 지연시간, 서비스 모델링에 대한 문제를 해결하는데
과한 오버헤드가 발생할 수 있음
2. 비용
많아지는 프로세스,인스턴스,네트워크,스토리지로 인한 비용 증가
3. 보안
서비스간의 통신을 위해 네트워크를 모놀리식 시스템보다 더 많이 사용하게 되고 그만큼 중간자공격을 당할 가능성이 커지는 것
4. 테스팅
테스팅 설정을 위해 더 많은 비용이 소모됨
네트워크 문제로 테스트가 실패하는 false negative 도 발생 가능
5. 데이터베이스가 서비스별로 나눠있기 때문에 데이터일관성에 문제가 생길 수 있음

MSA가 적합하지 않은 곳
1. 초기 변경이 잦은 곳(도메인 모델이 계속 변화하기 때문)

적합한 곳


